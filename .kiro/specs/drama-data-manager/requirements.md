# 需求文档

## 简介

剧名数据管理系统是一个 Python 桌面应用程序，支持多后台管理、剧名库维护、月份数据空间、Excel 数据导入匹配、统计与导出功能。所有数据通过 SQLite 本地持久化，界面使用 tkinter 构建，支持中文显示。

## 术语表

- **系统（System）**: 剧名数据管理系统桌面应用程序
- **后台（Backend）**: 一个独立的数据管理空间，拥有独立的剧名库和月份数据，如"A后台"、"B后台"
- **剧名库（Drama_Library）**: 属于某个后台的剧名集合，用于与导入数据进行匹配
- **月份（Month_Space）**: 属于某个后台的独立数据空间，以"YYYY年MM月"格式标识
- **导入数据（Imported_Data）**: 从 Excel 文件导入到某个月份空间的表格数据
- **匹配（Matching）**: 将导入数据中的"合集名称"列与该后台剧名库进行比对的过程
- **匹配行（Matched_Row）**: 导入数据中"合集名称"列的值存在于剧名库中的整行数据
- **数据视图（Data_View）**: 用户查看数据的筛选模式，包括"全部数据"、"仅匹配"、"仅未匹配"

## 需求

### 需求 1：后台管理

**用户故事：** 作为用户，我希望能够创建和管理多个独立的后台，以便分别管理不同来源的剧名数据。

#### 验收标准

1. WHEN 用户点击"新建后台"按钮并输入后台名称, THE 系统 SHALL 创建一个新的后台并将其显示在后台列表中
2. WHEN 用户选择一个后台并点击"删除后台"按钮, THE 系统 SHALL 删除该后台及其所有关联数据（剧名库、月份数据），并从列表中移除
3. WHEN 用户删除后台前, THE 系统 SHALL 弹出确认对话框，要求用户确认删除操作
4. THE 系统 SHALL 在后台列表中显示所有已创建的后台名称
5. WHEN 用户双击或选择一个后台, THE 系统 SHALL 进入该后台的管理界面

### 需求 2：剧名库管理

**用户故事：** 作为用户，我希望能够为每个后台维护独立的剧名库，以便后续与导入数据进行匹配。

#### 验收标准

1. WHEN 用户在某个后台中打开剧名库管理界面, THE 系统 SHALL 显示该后台当前所有剧名
2. WHEN 用户输入剧名并点击"添加"按钮, THE 系统 SHALL 将该剧名添加到当前后台的剧名库中
3. WHEN 用户选择一个剧名并点击"删除"按钮, THE 系统 SHALL 从当前后台的剧名库中移除该剧名
4. WHEN 用户点击"批量导入"按钮并选择 Excel 或文本文件, THE 系统 SHALL 从文件中读取剧名列表并批量添加到剧名库中
5. WHEN 剧名库发生变更（添加、删除、批量导入）, THE 系统 SHALL 立即将变更持久化到 SQLite 数据库
6. IF 用户尝试添加已存在于剧名库中的剧名, THEN THE 系统 SHALL 忽略重复项并提示用户

### 需求 3：月份数据空间管理

**用户故事：** 作为用户，我希望能够在每个后台中创建月份数据空间，以便按月份组织和管理导入的数据。

#### 验收标准

1. WHEN 用户进入某个后台后点击"新建月份"按钮, THE 系统 SHALL 创建一个新的月份数据空间并显示在月份列表中
2. WHEN 用户选择一个月份并点击"删除月份"按钮, THE 系统 SHALL 删除该月份及其所有导入数据和匹配结果
3. WHEN 用户选择一个月份并进入, THE 系统 SHALL 显示该月份的数据表格界面
4. WHEN 新创建的月份被打开, THE 系统 SHALL 显示空白的数据表格
5. IF 用户尝试创建已存在的月份, THEN THE 系统 SHALL 提示用户该月份已存在

### 需求 4：数据导入

**用户故事：** 作为用户，我希望能够将 Excel 表格数据导入到月份空间中，以便进行后续的匹配操作。

#### 验收标准

1. WHEN 用户在某个月份空间中点击"导入"按钮并选择 Excel 文件, THE 系统 SHALL 读取 Excel 文件中的所有列和行数据
2. WHEN Excel 数据导入完成, THE 系统 SHALL 在界面表格中显示所有导入的数据，包括表头和所有行
3. WHEN 数据导入完成, THE 系统 SHALL 将导入的数据持久化到 SQLite 数据库
4. IF 导入的 Excel 文件格式无效或无法读取, THEN THE 系统 SHALL 显示错误提示信息
5. WHEN 用户对已有数据的月份重新导入, THE 系统 SHALL 替换该月份的旧数据为新导入的数据

### 需求 5：数据匹配

**用户故事：** 作为用户，我希望能够将导入的数据与后台剧名库进行匹配，以便快速筛选出相关的数据行。

#### 验收标准

1. WHEN 用户点击"匹配"按钮, THE 系统 SHALL 将当前月份导入数据中"合集名称"列的值与该后台的剧名库进行逐行比对
2. WHEN 匹配完成, THE 系统 SHALL 标记所有匹配成功的行，并默认显示仅匹配的数据
3. WHEN 匹配完成, THE 系统 SHALL 将匹配结果持久化到 SQLite 数据库
4. WHEN 用户点击"重新匹配"按钮, THE 系统 SHALL 使用当前最新的剧名库重新执行匹配操作
5. THE 匹配器 SHALL 在比对时去除剧名首尾空格后进行精确匹配
6. IF 导入数据中不存在"合集名称"列, THEN THE 系统 SHALL 提示用户选择用于匹配的列

### 需求 6：数据视图切换

**用户故事：** 作为用户，我希望能够在不同的数据视图之间切换，以便查看全部数据、仅匹配数据或仅未匹配数据。

#### 验收标准

1. WHEN 用户选择"全部数据"视图, THE 系统 SHALL 在表格中显示当前月份的所有导入数据行
2. WHEN 用户选择"仅匹配"视图, THE 系统 SHALL 在表格中仅显示匹配成功的数据行
3. WHEN 用户选择"仅未匹配"视图, THE 系统 SHALL 在表格中仅显示未匹配的数据行
4. WHEN 视图切换时, THE 系统 SHALL 保留所有列的完整数据

### 需求 7：数据统计

**用户故事：** 作为用户，我希望能够查看数据的统计信息，以便快速了解匹配情况和数值汇总。

#### 验收标准

1. WHEN 数据显示在表格中, THE 系统 SHALL 在表格底部显示每一列的合计值（仅对数值列求和）
2. WHEN 匹配完成, THE 系统 SHALL 显示匹配数量统计（匹配行数 / 总行数）
3. WHEN 视图切换时, THE 系统 SHALL 根据当前视图中显示的数据重新计算合计值

### 需求 8：数据导出

**用户故事：** 作为用户，我希望能够将匹配结果导出为新的 Excel 文件，以便分享或进一步处理。

#### 验收标准

1. WHEN 用户点击"导出"按钮, THE 系统 SHALL 将当前视图中显示的数据（含表头）导出为新的 Excel 文件
2. WHEN 导出操作完成, THE 系统 SHALL 提示用户导出成功并显示文件保存路径
3. IF 导出过程中发生错误, THEN THE 系统 SHALL 显示错误提示信息

### 需求 9：数据持久化

**用户故事：** 作为用户，我希望所有数据在关闭应用后仍然保留，以便下次打开时继续使用。

#### 验收标准

1. THE 系统 SHALL 使用 SQLite 数据库存储所有后台列表、剧名库、月份数据和匹配结果
2. WHEN 应用程序启动时, THE 系统 SHALL 从 SQLite 数据库加载所有已保存的数据
3. WHEN 任何数据发生变更, THE 系统 SHALL 立即将变更写入 SQLite 数据库
4. THE 系统 SHALL 将数据库文件存储在应用程序同级目录下
